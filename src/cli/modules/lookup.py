import urllib
from urllib import request
import json

def lookup_file(hash):
    "Check if the file hash is on malware bazzar"
    url = "https://mb-api.abuse.ch/api/v1/"
    params = {"hash": hash, "query": "get_info"}
    data = urllib.parse.urlencode(params).encode('utf-8')
    req = urllib.request.Request(url, data)
    resp = urllib.request.urlopen(req)
    resp_data = json.loads(resp.read().decode('utf-8'))
    return resp_data

def check_file(hash):
    data = lookup_file(hash)
    if data["query_status"] != "ok":
        return data["query_status"]
    result = {}
    result["name"] = ""
    result["type"] = ""
    result["size"] = ""
    result["name"] = str(data["data"][0]["signature"]).replace("None","Unknown")+"."+data["data"][0]["file_type_mime"]
    result["type"] = data["data"][0]["file_type"]
    result["size"] = data["data"][0]["file_size"]
    return result